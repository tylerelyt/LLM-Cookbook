# Lesson 4: 注意力重述机制与目标聚焦管理

本课程深入研究Manus的注意力操控策略，学习如何通过自然语言重述来引导Agent的注意力，避免在长任务中偏离目标。

## 🎯 学习目标

- **注意力机制**: 理解LLM注意力分布的特性和局限
- **重述策略**: 掌握通过自然语言操控注意力的技巧
- **目标维护**: 实现长期复杂任务中的目标一致性
- **动态规划**: 构建自适应的任务分解和执行机制

## 🧠 注意力挑战

### "迷失在中间"问题
在长上下文或复杂任务中，Agent容易：
- **偏离主题**: 被中间观察分散注意力
- **遗忘目标**: 丢失最初的任务目标
- **决策漂移**: 逐步偏离最优路径

### 长循环任务的困境
Manus的典型任务需要约50次工具调用：
- **上下文膨胀**: 每次操作都增加上下文长度
- **注意力稀释**: 关键信息被大量历史信息掩盖
- **目标模糊**: 初始目标在长序列中变得不突出

## 💡 Manus的重述解决方案

### Todo.md机制
你可能注意到Manus的有趣行为：
- **自动创建**: 复杂任务时自动创建`todo.md`文件
- **逐步更新**: 随任务进展实时更新待办列表
- **状态追踪**: 标记已完成和待处理项目

### 注意力操控原理
```
重述 = 将目标推入注意力焦点
     = 避免"迷失在中间"
     = 维持目标一致性
```

## 🛠️ 实践练习

### 练习1: 智能Todo管理器
构建能够自动生成和维护任务列表的系统。

### 练习2: 注意力追踪器
实现监控和分析Agent注意力分布的工具。

### 练习3: 自适应重述引擎
开发根据任务复杂度调整重述频率的机制。

## 📁 文件说明

- `attention_manager.py`: 注意力管理核心组件
- `todo_generator.py`: 智能任务列表生成器
- `recitation_engine.py`: 重述机制实现
- `goal_tracker.py`: 目标一致性监控工具

## 🔍 核心技术

### 1. 动态任务分解
```python
class TaskDecomposer:
    def decompose_goal(self, goal):
        """将复杂目标分解为可执行步骤"""
        
    def update_progress(self, completed_step):
        """更新进度并调整后续步骤"""
        
    def generate_todo(self):
        """生成当前的todo.md内容"""
```

### 2. 注意力引导
```python
class AttentionGuide:
    def inject_goal_reminder(self, context):
        """在上下文末尾注入目标提醒"""
        
    def bias_attention(self, current_state):
        """通过重述偏向注意力分布"""
```

### 3. 进度可视化
实时展示任务执行状态：
- ✅ 已完成的步骤
- 🔄 正在执行的步骤  
- ⏳ 待处理的步骤
- 🎯 最终目标

## 🚀 实战案例

### 案例1: 复杂代码重构
50步操作的大型代码库重构任务：
```markdown
# todo.md
## 代码重构任务进度
- [x] 分析现有架构
- [x] 识别重构目标模块
- [🔄] 重构数据层
  - [x] 用户模型重构
  - [🔄] 权限模型重构
  - [ ] 数据验证层
- [ ] 重构API层
- [ ] 更新测试用例
- [ ] 性能验证

🎯 **最终目标**: 提升系统可维护性和性能
```

### 案例2: 市场调研报告
多源信息收集和分析：
```markdown
# research_progress.md
## 市场调研进度追踪
- [x] 竞品分析
  - [x] 产品A功能调研  
  - [x] 产品B定价策略
- [🔄] 用户访谈
  - [x] 准备访谈问题
  - [🔄] 执行用户访谈 (3/10完成)
- [ ] 数据分析和报告生成

🎯 **核心目标**: 为产品定位提供数据支撑
```

## 💡 设计原则

> "通过不断重写todo列表，Manus将目标重述到上下文末尾，将全局计划推入模型的最近注意力范围，避免在复杂任务中迷失方向。"
> — Manus AI Team

### 重述的艺术
1. **频率控制**: 过于频繁会干扰决策，过少会失去效果
2. **内容精炼**: 重述内容要简洁但包含关键信息
3. **动态调整**: 根据任务进展调整重述策略
4. **自然整合**: 重述应该自然融入Agent的工作流程

## 🧪 高级技巧

### 多层次重述
- **宏观目标**: 项目最终目标
- **中观计划**: 当前阶段任务
- **微观步骤**: 下一个具体行动

### 条件重述
根据不同条件触发重述：
- **时间触发**: 每N步操作后重述
- **复杂度触发**: 检测到复杂决策时重述
- **偏离检测**: 发现偏离目标时强制重述

## 🚀 开始实践

```bash
# 安装依赖
pip install -r requirements.txt

# 运行注意力管理演示
python attention_manager.py --demo

# 测试Todo生成器
python todo_generator.py --task "复杂项目规划"

# 分析注意力分布
python goal_tracker.py --analyze
```

## 📊 评估指标

- **目标一致性**: 任务执行与初始目标的偏离程度
- **完成率**: 复杂多步任务的成功完成比例
- **效率提升**: 重述机制对任务效率的改善
- **注意力聚焦度**: 关键信息在注意力分布中的权重 