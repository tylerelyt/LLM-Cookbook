# Lesson 5: é”™è¯¯ä¿ç•™ç­–ç•¥ä¸å¤±è´¥å­¦ä¹ æœºåˆ¶

æœ¬è¯¾ç¨‹æ¢ç´¢Manusçš„åç›´è§‰è§‚ç‚¹ï¼šä¸éšè—é”™è¯¯ï¼Œè€Œæ˜¯ä¿ç•™å®ƒä»¬ã€‚å­¦ä¹ å¦‚ä½•è®©Agentä»å¤±è´¥ä¸­å­¦ä¹ ï¼Œå°†é”™è¯¯è½¬åŒ–ä¸ºæ”¹è¿›çš„æœºä¼šã€‚

## ğŸ¯ å­¦ä¹ ç›®æ ‡

- **é”™è¯¯ä»·å€¼è§‚**: ç†è§£é”™è¯¯åœ¨Agentå­¦ä¹ ä¸­çš„ç§¯æä½œç”¨
- **ä¸Šä¸‹æ–‡ä¿ç•™**: æŒæ¡é”™è¯¯ä¿¡æ¯çš„æœ‰æ•ˆä¿ç•™ç­–ç•¥
- **é€‚åº”æ€§å­¦ä¹ **: å®ç°åŸºäºé”™è¯¯çš„åŠ¨æ€è¡Œä¸ºè°ƒæ•´
- **æ¢å¤æœºåˆ¶**: æ„å»ºä¼˜é›…çš„é”™è¯¯æ¢å¤å’Œé‡è¯•ç³»ç»Ÿ

## âŒ ä¼ ç»Ÿé”™è¯¯å¤„ç†çš„è¯¯åŒº

### å¸¸è§çš„"æ¸…ç†"å†²åŠ¨
å¼€å‘è€…é€šå¸¸å€¾å‘äºï¼š
- **éšè—é”™è¯¯**: æ¸…ç†é”™è¯¯è½¨è¿¹ï¼Œåªä¿ç•™æˆåŠŸè·¯å¾„
- **é‡ç½®çŠ¶æ€**: å‡ºé”™æ—¶é‡ç½®æ¨¡å‹çŠ¶æ€ï¼Œ"é‡æ–°å¼€å§‹"
- **æ¨¡ç³Šå¤„ç†**: ä¾èµ–"ç¥å¥‡çš„temperature"æ¥è§£å†³é—®é¢˜

### éšè—é”™è¯¯çš„ä»£ä»·
è¿™ç§åšæ³•çœ‹ä¼¼æ›´å®‰å…¨ã€æ›´å¯æ§ï¼Œä½†å®é™…ä¸Šï¼š
- **ä¸¢å¤±è¯æ®**: é”™è¯¯è½¨è¿¹åŒ…å«å®è´µçš„å­¦ä¹ ä¿¡æ¯
- **é‡å¤çŠ¯é”™**: æ²¡æœ‰è¯æ®ï¼ŒAgentæ— æ³•é¿å…é‡å¤é”™è¯¯
- **é€‚åº”æ€§å·®**: å¤±å»äº†è‡ªæˆ‘çº æ­£çš„èƒ½åŠ›

## ğŸ’¡ Manusçš„é”™è¯¯ä¿ç•™å“²å­¦

### æ ¸å¿ƒç†å¿µ
> "é”™è¯¯ä¸æ˜¯bugï¼Œè€Œæ˜¯featureã€‚é”™è¯¯æ¢å¤æ˜¯çœŸæ­£Agentè¡Œä¸ºçš„æœ€æ¸…æ™°æŒ‡æ ‡ã€‚"

### ä¿ç•™ç­–ç•¥
1. **å®Œæ•´ä¿ç•™**: ä¿ç•™å¤±è´¥çš„è¡ŒåŠ¨å’Œç›¸åº”çš„è§‚å¯Ÿ
2. **ä¸Šä¸‹æ–‡å­¦ä¹ **: è®©æ¨¡å‹çœ‹åˆ°é”™è¯¯åŠå…¶åæœ
3. **éšå¼æ›´æ–°**: é€šè¿‡é”™è¯¯è¯æ®éšå¼æ›´æ–°æ¨¡å‹ä¿¡å¿µ
4. **å…ˆéªŒåç§»**: é™ä½é‡å¤ç›¸ä¼¼é”™è¯¯çš„æ¦‚ç‡

## ğŸ› ï¸ å®è·µç»ƒä¹ 

### ç»ƒä¹ 1: é”™è¯¯è½¨è¿¹åˆ†æå™¨
æ„å»ºåˆ†æå’Œå¯è§†åŒ–Agenté”™è¯¯æ¨¡å¼çš„å·¥å…·ã€‚

### ç»ƒä¹ 2: è‡ªé€‚åº”é‡è¯•æœºåˆ¶
å®ç°èƒ½ä»é”™è¯¯ä¸­å­¦ä¹ çš„æ™ºèƒ½é‡è¯•ç³»ç»Ÿã€‚

### ç»ƒä¹ 3: é”™è¯¯æ¢å¤è¯„ä¼°
å¼€å‘è¯„ä¼°Agenté”™è¯¯æ¢å¤èƒ½åŠ›çš„åŸºå‡†æµ‹è¯•ã€‚

## ğŸ“ æ–‡ä»¶è¯´æ˜

- `error_tracker.py`: é”™è¯¯è½¨è¿¹è®°å½•å’Œåˆ†æ
- `recovery_engine.py`: é”™è¯¯æ¢å¤æœºåˆ¶å®ç°
- `failure_learner.py`: ä»å¤±è´¥ä¸­å­¦ä¹ çš„æ ¸å¿ƒé€»è¾‘
- `adaptive_retry.py`: è‡ªé€‚åº”é‡è¯•ç­–ç•¥

## ğŸ” é”™è¯¯ç±»å‹åˆ†æ

### 1. ç¯å¢ƒé”™è¯¯
```python
# ç¤ºä¾‹ï¼šAPIè°ƒç”¨å¤±è´¥
action = {"tool": "api_call", "endpoint": "/users"}
observation = {
    "error": "ConnectionTimeout",
    "message": "Request timed out after 30s",
    "timestamp": "2025-07-20T10:30:00Z"
}
# ä¿ç•™æ­¤é”™è¯¯ï¼Œè®©Agentå­¦ä¼šå¤„ç†ç½‘ç»œé—®é¢˜
```

### 2. é€»è¾‘é”™è¯¯
```python
# ç¤ºä¾‹ï¼šé”™è¯¯çš„å‚æ•°é€‰æ‹©
action = {"tool": "calculator", "operation": "divide", "a": 10, "b": 0}
observation = {
    "error": "ZeroDivisionError", 
    "message": "division by zero",
    "stack_trace": "..."
}
# ä¿ç•™æ­¤é”™è¯¯ï¼Œè®©Agentå­¦ä¼šå‚æ•°éªŒè¯
```

### 3. è¯­ä¹‰é”™è¯¯
```python
# ç¤ºä¾‹ï¼šè¯¯è§£ä»»åŠ¡è¦æ±‚
action = {"tool": "file_write", "path": "/tmp/summary.txt", "content": "detailed analysis..."}
observation = {
    "error": "TaskMismatchError",
    "message": "Expected summary but got detailed analysis",
    "expected_length": "< 100 words",
    "actual_length": "500 words"
}
# ä¿ç•™æ­¤é”™è¯¯ï¼Œè®©Agentå­¦ä¼šä»»åŠ¡ç†è§£
```

## ğŸ§  å­¦ä¹ æœºåˆ¶åŸç†

### éšå¼ä¿¡å¿µæ›´æ–°
å½“Agentçœ‹åˆ°é”™è¯¯æ—¶ï¼š
```
Prior(Action_Similar) = High
After seeing Error:
Posterior(Action_Similar) = Lower
```

### é”™è¯¯æ¨¡å¼è¯†åˆ«
Agentå­¦ä¼šè¯†åˆ«å¯¼è‡´é”™è¯¯çš„æ¨¡å¼ï¼š
- **å‚æ•°ç»„åˆ**: å“ªäº›å‚æ•°ç»„åˆå®¹æ˜“å‡ºé”™
- **ç¯å¢ƒçŠ¶æ€**: åœ¨ä»€ä¹ˆçŠ¶æ€ä¸‹å®¹æ˜“å¤±è´¥
- **æ—¶åºä¾èµ–**: æŸäº›æ“ä½œçš„æ—¶åºè¦æ±‚

## ğŸš€ å®æˆ˜æ¡ˆä¾‹

### æ¡ˆä¾‹1: æ–‡ä»¶æ“ä½œé”™è¯¯å­¦ä¹ 
```python
# ç¬¬ä¸€æ¬¡å°è¯•
action_1 = {"tool": "file_read", "path": "/nonexistent/file.txt"}
observation_1 = {"error": "FileNotFoundError", "path": "/nonexistent/file.txt"}

# Agentåœ¨ä¸Šä¸‹æ–‡ä¸­çœ‹åˆ°è¿™ä¸ªé”™è¯¯ï¼Œå­¦ä¼šå…ˆæ£€æŸ¥æ–‡ä»¶å­˜åœ¨æ€§
action_2 = {"tool": "file_exists", "path": "/target/file.txt"}
observation_2 = {"exists": true}

action_3 = {"tool": "file_read", "path": "/target/file.txt"}
observation_3 = {"content": "file content...", "success": true}
```

### æ¡ˆä¾‹2: APIé‡è¯•ç­–ç•¥å­¦ä¹ 
```python
# ä¿ç•™çš„é”™è¯¯å†å²å¸®åŠ©Agentå­¦ä¼šæŒ‡æ•°é€€é¿
errors_seen = [
    {"attempt": 1, "error": "RateLimit", "retry_after": 1},
    {"attempt": 2, "error": "RateLimit", "retry_after": 2}, 
    {"attempt": 3, "error": "RateLimit", "retry_after": 4}
]

# Agentå­¦ä¼šæ›´æ™ºèƒ½çš„é‡è¯•ç­–ç•¥
action_next = {
    "tool": "wait", 
    "duration": 8,  # å­¦ä¼šäº†æŒ‡æ•°é€€é¿
    "reason": "Rate limit pattern detected"
}
```

## ğŸ’¡ è®¾è®¡åŸåˆ™

### 1. ä¿ç•™ä½†ç»“æ„åŒ–
```python
class ErrorContext:
    def __init__(self):
        self.error_history = []
        self.success_patterns = []
        self.failure_patterns = []
    
    def add_error(self, action, error, context):
        """ç»“æ„åŒ–ä¿å­˜é”™è¯¯ä¿¡æ¯"""
        error_record = {
            "action": action,
            "error": error,
            "context": context,
            "timestamp": now(),
            "recovery_attempts": []
        }
        self.error_history.append(error_record)
```

### 2. å¤šæ ·æ€§ä¿æŒ
é¿å…Agenté™·å…¥é”™è¯¯æ¨¡å¼çš„å›ºåŒ–ï¼š
```python
def add_diversity(self, context):
    """åœ¨é”™è¯¯ä¸Šä¸‹æ–‡ä¸­æ·»åŠ å¤šæ ·æ€§"""
    # ä¸åŒçš„é”™è¯¯æè¿°æ–¹å¼
    # éšæœºåŒ–æŸäº›éå…³é”®ç»†èŠ‚
    # ä¿æŒæ ¸å¿ƒé”™è¯¯ä¿¡æ¯ä¸å˜
```

## ğŸ”¬ é«˜çº§ç­–ç•¥

### é”™è¯¯åˆ†ç±»å­¦ä¹ 
```python
class ErrorClassifier:
    def classify_error(self, error):
        """åˆ†ç±»é”™è¯¯ç±»å‹ä»¥ä¾¿é’ˆå¯¹æ€§å­¦ä¹ """
        return {
            "type": "transient|permanent|configuration",
            "severity": "low|medium|high|critical",
            "recovery_strategy": "retry|skip|alternative|abort"
        }
```

### æ¢å¤ç­–ç•¥ä¼˜åŒ–
```python
class RecoveryOptimizer:
    def suggest_recovery(self, error, history):
        """åŸºäºå†å²é”™è¯¯å»ºè®®æ¢å¤ç­–ç•¥"""
        similar_errors = self.find_similar(error, history)
        successful_recoveries = [e for e in similar_errors if e.recovered]
        return self.recommend_strategy(successful_recoveries)
```

## ğŸ“Š è¯„ä¼°æŒ‡æ ‡

- **é”™è¯¯æ¢å¤ç‡**: ä»é”™è¯¯ä¸­æˆåŠŸæ¢å¤çš„æ¯”ä¾‹
- **é‡å¤é”™è¯¯å‡å°‘ç‡**: ç›¸åŒé”™è¯¯é‡å¤å‘ç”Ÿçš„ä¸‹é™è¶‹åŠ¿  
- **é€‚åº”æ—¶é—´**: Agentå­¦ä¼šé¿å…ç‰¹å®šé”™è¯¯çš„æ—¶é—´
- **æ¢å¤æ•ˆç‡**: é”™è¯¯æ¢å¤æ‰€éœ€çš„å¹³å‡æ­¥æ•°

## ğŸš€ å¼€å§‹å®è·µ

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è¿è¡Œé”™è¯¯åˆ†ææ¼”ç¤º
python error_tracker.py --analyze

# æµ‹è¯•æ¢å¤æœºåˆ¶
python recovery_engine.py --test-scenarios

# è¯„ä¼°å­¦ä¹ æ•ˆæœ
python failure_learner.py --benchmark
```

## ğŸ¯ å…³é”®æ´å¯Ÿ

> "åœ¨å¤šæ­¥ä»»åŠ¡ä¸­ï¼Œå¤±è´¥ä¸æ˜¯å¼‚å¸¸ï¼Œè€Œæ˜¯å¸¸æ€ã€‚è¯­è¨€æ¨¡å‹ä¼šå¹»è§‰ï¼Œç¯å¢ƒä¼šè¿”å›é”™è¯¯ï¼Œå¤–éƒ¨å·¥å…·ä¼šå¼‚å¸¸ï¼Œæ„å¤–è¾¹ç•Œæƒ…å†µæ€»ä¼šå‡ºç°ã€‚éšè—è¿™äº›å¤±è´¥ä¼šç§»é™¤è¯æ®ï¼Œæ²¡æœ‰è¯æ®ï¼Œæ¨¡å‹å°±æ— æ³•é€‚åº”ã€‚"
> â€” Manus AI Team

æœ€å¼ºçš„Agentä¸æ˜¯ä»ä¸çŠ¯é”™çš„Agentï¼Œè€Œæ˜¯èƒ½å¤Ÿä¼˜é›…æ¢å¤ã€ä»é”™è¯¯ä¸­å­¦ä¹ ã€æŒç»­æ”¹è¿›çš„Agentã€‚ 